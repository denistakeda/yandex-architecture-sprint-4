# Архитектурное решение по логированию

## Необходимые логи

| Сервис | Уровень логов | Событие | Данные |
| ------ | ------------- | ------- | ------ |
| Orders Service | INFO | Создание заказа | Пользователь, номер заказа |
| Orders Service | INFO | Изменение статуса заказа | Пользователь, номер заказа |
| Price Calculator | INFO | Начало подсчета стоимости заказа | Номер заказа, название файла |
| Price Calculator | INFO | Завершение подсчета стоимости заказа | Номер заказа, название файла |
| Price Calculator | ERROR | Ошибка в подсчете стоимости заказа | Номер заказа, название файла, ошибка |

## Мотивация

Логирование позволит быстрее находить ошибки и проблемы сервисов. Бизнес метрики, на которые повлияет логирование:

1. Уровень удовлетворенности клиентов (после устранения существующих проблем)
2. SLA (так как скорость устранения проблем возрастет)
3. Скорость выпуска новых версий

## Предлагаемое решение

[Схема](./jewerly_c4_model_with_logging.drawio)

Для внедрения системы логирования предлагается использовать стек ELK. Требуется развернуть отдельные инстансы Elasticsearch, Logstash и Kibana, после чего необходимо интегрировать filebeat в каждый из следующих сервисов:

- Orders Service
- Price Calculator

Как и в случае трейсинга, подсистема логирования будет недоступна из глобальной сети интернет. Доступ будет осуществляться только из локальной сети посредством VPN. Доступ предоставляется только авторизованным пользователям с ролью "Поддержка".

Логи предлагается хранить в течение недели (этого срока обычно достаточно для того, чтобы обнаружить проблему и найти ее причину).

## Анализ логов

В дальнейшем логи можно использовать не только для того, чтобы находить проблемы в системе, а так же для того, чтобы автоматически уведомлять поддержку о появлении таких проблем, а так же для формирования метрик системы. Можно внедрить следующую функциональность:

1. Автоматическое уведомление о том, что подсчет стоимости заказа завершился с ошибкой
2. Метрика по текущим статусам заказов (сколько заказов находится в каждом из статусов)
3. Метрика пропускной способности сервиса Price Calculator
4. Соотношение поступивших заказов с выполнеными за период
5. Список заказов сформированных, но не попавший в работу в течение определенного срока
