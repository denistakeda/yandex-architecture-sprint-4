# Выбор и настройка мониторинга в системе

## Мотивация

Для своевременного обнаружения и анализа проблем, в систему необходимо добавить мониторинг. Это позволит узнать, какой сервис испытывает наибольшую нагрузку, есть ли проблемы с базой данных или файловым стораджем, увидеть дневные и сезонные всплески нагрузки и оценить отклик системы на них. При добавлении алертинга возможно так же быстрое реагирование на инциденты.

## Выбор подхода к мониторингу

Для всех пользовательских API (`Shop API`, `CRM API`, `MES API`) считаю оптимальным использование подхода RED. Для баз данных (`Shop DB`, `MES db`), очередей (`Messages Queue`) и файлового хранилища (`3d files storage`) - подход USE

## Метрики

### Shop API

- `Number of requests (RPS)` - необходима, чтобы понять фактическую нагрузку на сервис
- `Number of HTTP 5xx` - необходима, чтобы понять количество явных ошибок на сервисе, в качестве ярлыка можно использовать полный код HTTP
- `Kb trancfered (received)` - необходима, чтобы понять насколько много и какие большие файлы проходят через сервис
- `Responce time (latency)` - необходима, чтобы понять, как быстро сервис отвечает клиентам

### MES API

- `Number of requests (RPS)` - необходима, чтобы понять фактическую нагрузку на сервис
- `Number of HTTP 5xx` - необходима, чтобы понять количество явных ошибок на сервисе, в качестве ярлыка можно использовать полный код HTTP
- `Kb trancfered (received from clients)` - необходима, чтобы понять насколько много и какие большие файлы проходят через сервис
- `Kb trancfered (received from 3d filed storage)` - необходима, чтобы понять насколько интенсивно сервис взаимодействует с файловым стораджем
- `Responce time (latency)` - необходима, чтобы понять, как быстро сервис отвечает клиентам
- `CPU%` - система интенсивно использует CPU для подсчета стоимости, поэтому необходимо держать его использование под контролем

### CRM API

- `Number of requests (RPS)` - необходима, чтобы понять фактическую нагрузку на сервис
- `Number of HTTP 5xx` - необходима, чтобы понять количество явных ошибок на сервисе, в качестве ярлыка можно использовать полный код HTTP
- `Responce time (latency)` - необходима, чтобы понять, как быстро сервис отвечает клиентам

### Shop DB

- `Size` - необходимо, чтобы контролировать расходы на инфраструктуру и быстродействие системы
- `Disk utilization` - необходимо, чтобы контролировать быстродействие базы

### MES DB

- `Size` - необходимо, чтобы контролировать расходы на инфраструктуру и быстродействие системы
- `Disk utilization` - необходимо, чтобы контролировать быстродействие базы

### Messages Queue

- `Number of dead-letter-exchange letters in RabbitMQ` - для отслеживание ошибок в очереди и потребляющих сервисов
- `Number of in light in RabbitMQ` - для отслеживания размера очереди и возможности потребляющих сервисов справиться с нагрузкой

### 3d files storage

- `Size of S3 storage` - для контроля стоимости инфраструктуры
- `Disk utilization` - для понимания интенсивности использования

## План действий

1. Создать инстранс Prometheus и Grafana
2. В сервисы добавить сбор указанных метрик
3. Создать доски по каждому сервису
