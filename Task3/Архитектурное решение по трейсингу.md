# Архитектурное решение по трейсингу

## Мотивация

Трейсинг позволит локализовать текущие проблемы сервиса, а так же быстрее находить и устранять проблемы в дальнейшем. Бизнес метрики, на которые может повлиять трейсинг:

1. Уровень удовлетворенности клиентов (после устранения существующих проблем)
2. Количество принимаемых заказов
3. Средняя скорость обработки одного заказа

## Предлагаемое решение

[Схема](./jewerly_c4_model_with_tracing.drawio)

Следует добавить инстанс jaeger (Jaeger UI, collector, agent), а так же добавить трейсинг клиенты во все сервисы, которые работают с заказами.

Следующие сервисы должны включать трассировку в обязательном порядке:
- Shop API
- Orders Service
- Price Calculator

В следующие сервисы желательно (но не обязательно) включить трассировку:
- MES API
- CRM API

## Компромисы

1. Сложно добавить трассировку в MES API, так как эта система не писалась командой и может иметь непредсказуемую структуру
2. Нет смысла добавлять трассировку, если не выделить дополнительные сервисы (Orders Service, Price Calculator), так как в таком случае вся обработка запроса будет проходить в едином сервисе, и тогда это проще покрыть логами, чем трассировкой
3. Трассировка обработки одного заказа прирывается очередью.

## Безопасность

Для обеспечения безопасности предлагается все средства трассировки (Jaeger UI, collector, agent) полностью закрыть для доступа из глобальной сети интернет. Доступ осуществлять только из локальной сети посредством VPN. Jaeger UI должен предоставлять доступ только авторизованным пользователям с ролью "Поддержка"
